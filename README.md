**YM ‚Üí Lidarr**

–°–µ—Ä–≤–∏—Å, –∑–∞–±–∏—Ä–∞–µ—Ç **–ª–∞–π–∫–∏ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏** –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤ **Lidarr** (–∫–∞—Å—Ç–æ–º-–ª–∏—Å—Ç –∞—Ä—Ç–∏—Å—Ç–æ–≤ –∏–ª–∏ —Ä–µ–ª–∏–∑-–≥—Ä—É–ø–ø—ã –∞–ª—å–±–æ–º–æ–≤).

üöÄ **–í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏**

- –°–±–æ—Ä –ª–∞–π–∫–Ω—É—Ç—ã—Ö **—Ç—Ä–µ–∫–æ–≤/–∞–ª—å–±–æ–º–æ–≤** –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏.
- –ú–∞—Ç—á–∏–Ω–≥ —Å **MusicBrainz** (–∞—Ä—Ç–∏—Å—Ç—ã ‚Üí MBID, –∞–ª—å–±–æ–º—ã ‚Üí release-group MBID).
- **Push –≤ Lidarr**: –∞—Ä—Ç–∏—Å—Ç—ã (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ –∞–ª—å–±–æ–º—ã.
- –≠–∫—Å–ø–æ—Ä—Ç **JSON/CSV/MD** (–ø—Ä—è–º–æ –∏–∑ –ë–î, –±–µ–∑ —Ñ–∞–π–ª–æ–≤-–∫—É—Å–∫–æ–≤).
- –í–∫–ª–∞–¥–∫–∏ **Found / Unmatched** —Å –∫–∞–Ω–¥–∏–¥–∞—Ç–∞–º–∏ –∏ —Å—Å—ã–ª–∫–∞–º–∏ –Ω–∞ MB/Yandex Music.
- **Live Logs** ‚Äî –æ–Ω–ª–∞–π–Ω–æ–≤—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ —Ç–µ–∫—É—â–µ–≥–æ/–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–≥–æ–Ω–∞.
- **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ**: —Ç–æ–∫–µ–Ω—ã/–∫–ª—é—á–∏, —Ä–µ–∂–∏–º—ã, —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è, —á–∞—Å—Ç–æ—Ç—ã.
- **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫** (cron) –¥–ª—è –Ø–Ω–¥–µ–∫—Å-—Å–∏–Ω–∫–∞, –õ–∏–¥–∞—Ä—Ä-–ø—É—à–∞ –∏ –±—ç–∫–∞–ø–æ–≤ (–≤–∫–ª/–≤—ã–∫–ª).
- **–ë—ç–∫–∞–ø—ã SQLite** (VACUUM INTO) —Å —Ä–æ—Ç–∞—Ü–∏–µ–π.
- **–ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏** –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–∏–Ω–∫–∞: Telegram –∏–ª–∏ Webhook.
- **Health-checks** –¥–ª—è –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (web/api/pyproxy).
- –í—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ **SQLite** (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∫—ç—à–∏, –∫–∞–Ω–¥–∏–¥–∞—Ç—ã, –ª–æ–≥–∏, —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã).

üß© **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**

```
Next.js (web, 3000)  ‚îÄ‚îÄ>  Node.js API (4000)  ‚îÄ‚îÄ>  SQLite (Prisma)
```

- **web** ‚Äî Next.js 14, UI –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞.
- **api** ‚Äî Express + Prisma, –≤—Å—è –ª–æ–≥–∏–∫–∞, cron, —ç–∫—Å–ø–æ—Ä—Ç, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏.
- **pyproxy** ‚Äî FastAPI, –±–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å –Ø–ú (–æ–±—Ö–æ–¥–∏—Ç SmartCaptcha).

üì¶ **–ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (Docker)**
–¢—Ä–µ–±—É–µ—Ç—Å—è Docker –∏ docker compose v2.

```bash

# 1) —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å
git clone <repo>
cd <repo>

# 2) (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) –∑–∞–¥–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ .env
cp .env.example .env

# 3) —Å–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker compose up -d --build

# web: http://localhost:3000
# api: http://localhost:4000/health
# pyproxy: http://localhost:8080/health
```

**–ü—Ä–∏–º–µ—Ä** `docker-compose.yml`

```yaml
services:
  api:
    build:
      context: .
      dockerfile: docker/api.Dockerfile
    environment:
      - NODE_ENV=production
      - DATABASE_URL=file:/app/data/app.db
      - YA_PYPROXY_URL=http://pyproxy:8080
      - MB_RECHECK_HOURS=168
    ports:
      - '4000:4000'
    volumes:
      - db:/app/data
    healthcheck:
      test: ['CMD-SHELL', 'curl -fsS http://localhost:4000/health || exit 1']
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      - pyproxy

  web:
    build:
      context: .
      dockerfile: docker/web.Dockerfile
    environment:
      - NEXT_PUBLIC_API_BASE=http://localhost:4000
      - NODE_ENV=production
    ports:
      - '3000:3000'
    healthcheck:
      test: ['CMD-SHELL', 'curl -fsS http://localhost:3000/health || exit 1']
      interval: 30s
      timeout: 5s
      retries: 3
    depends_on:
      - api

  pyproxy:
    build:
      context: apps/pyproxy
      dockerfile: Dockerfile
    ports:
      - '8080:8080'
    healthcheck:
      test: ['CMD-SHELL', 'curl -fsS http://localhost:8080/health || exit 1']
      interval: 30s
      timeout: 5s
      retries: 3

volumes:
  db:
```

üßë‚Äçüíª **–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞**

–¢—Ä–µ–±—É–µ—Ç—Å—è Node.js ‚â• 18.17 (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 20.x) –∏ npm.

```bash
npm i

# prisma
export DATABASE_URL="file:./data/app.db"
npx prisma generate
npx prisma migrate dev --name init

# dev-—Å–µ—Ä–≤–µ—Ä—ã (–≤ —Ä–∞–∑–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö):
npm run dev:api   # http://localhost:4000
npm run dev:web   # http://localhost:3000

# pyproxy (python >= 3.10)
cd apps/pyproxy
pip install -r requirements.txt
uvicorn main:app --host 0.0.0.0 --port 8080
```

–í –ø—Ä–æ–¥–µ/–≤ –¥–æ–∫–µ—Ä–µ Prisma –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—É—Ç—å file:/app/data/app.db.

‚öôÔ∏è **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–≤–æ —Ñ—Ä–æ–Ω—Ç–µ)**
**Yandex Music**

- Driver: pyproxy (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ native. –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è pyproxy.
- PyProxy URL: –Ω–∞–ø—Ä–∏–º–µ—Ä, http://pyproxy:8080.
- Yandex token: OAuth —Ç–æ–∫–µ–Ω –Ø–ú.
- Sync cron (Yandex): CRON-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –ø—É—Å—Ç–æ (–æ—Ç–∫–ª—é—á–µ–Ω–æ).

**Lidarr**

- Push target: artists (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) –∏–ª–∏ albums (release-groups).
- Lidarr URL: http://lidarr:8686
- Lidarr API key: –∫–ª—é—á API.
- Sync cron (Lidarr push): CRON –∏–ª–∏ –ø—É—Å—Ç–æ (–æ—Ç–∫–ª—é—á–µ–Ω–æ).

**Backups (SQLite)**

- Enabled: –≤–∫–ª/–≤—ã–∫–ª.
- Cron: —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –±—ç–∫–∞–ø–∞.
- Retention (files): —Å–∫–æ–ª—å–∫–æ —Ñ–∞–π–ª–æ–≤ –¥–µ—Ä–∂–∞—Ç—å.
- Directory: –∫–∞—Ç–∞–ª–æ–≥ –±—ç–∫–∞–ø–æ–≤ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é /app/data/backups).
- –ë—ç–∫–∞–ø –¥–µ–ª–∞–µ—Ç –∞—Ç–æ–º–Ω—ã–π —Å–Ω–∞–ø—à–æ—Ç —á–µ—Ä–µ–∑ VACUUM INTO.

**Notifications**

- Type: none / telegram / webhook.
- Telegram:
  - Telegram Bot Token
  - Telegram Chat ID
- Webhook:
  - Webhook URL
  - Webhook Secret (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø–æ–¥–ø–∏—Å–∏ HMAC-SHA256 –≤ –∑–∞–≥–æ–ª–æ–≤–∫–µ X-Signature).

üñ•Ô∏è **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å**
**Overview** ‚Äî –æ–±—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –∑–∞–ø—É—Å–∫ —Å–∏–Ω–∫–∞/–ø—É—à–∞.
**Found** ‚Äî —Å–º–∞—Ç—á–µ–Ω–Ω—ã–µ –∞—Ä—Ç–∏—Å—Ç—ã/–∞–ª—å–±–æ–º—ã (—Å—Å—ã–ª–∫–∏ –Ω–∞ MB –∏ YM).
**Unmatched** ‚Äî –Ω–µ —Å–º–∞—Ç—á–µ–Ω–Ω—ã–µ, –∫–∞–Ω–¥–∏–¥–∞—Ç—ã c –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π, —Å—Å—ã–ª–∫–∏ –Ω–∞ MB/YM.
**Live Logs** ‚Äî –ª–æ–≥–∏ —Ç–µ–∫—É—â–µ–≥–æ/–ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∑–∞–ø—É—Å–∫–∞, –æ–Ω–ª–∞–π–Ω-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.
**Settings** ‚Äî –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, —Ç–µ—Å—Ç—ã –∫–æ–Ω–Ω–µ–∫—Ç–æ–≤, –∑–∞–ø—É—Å–∫ –±—ç–∫–∞–ø–∞, —Å—Å—ã–ª–∫–∏ –Ω–∞ —ç–∫—Å–ø–æ—Ä—Ç.

üîÅ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**

1. –°–±–æ—Ä –ª–∞–π–∫–æ–≤ —É –Ø–ú —á–µ—Ä–µ–∑ pyproxy (–∏–ª–∏ native).
2. –ò–∑ —Ç—Ä–µ–∫–æ–≤ —Å–æ–±–∏—Ä–∞–µ–º –∞—Ä—Ç–∏—Å—Ç–æ–≤ –∏ –∞–ª—å–±–æ–º—ã (—É–Ω–∏–∫–∞–ª—å–Ω–æ).
3. –ú–∞—Ç—á–∏–Ω–≥ —Å MusicBrainz c –∫—ç—à–µ–º –∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ–º —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤.
4. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤/–∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤/–∫—ç—à–∞ –≤ SQLite.
5. –ü—É—à –≤ Lidarr (–∞—Ä—Ç–∏—Å—Ç—ã/–∞–ª—å–±–æ–º—ã ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è).
6. Live-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –ë–î, –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ.

**Cool-down —Ä–µ–º–∞—Ç—á–∏–Ω–≥–∞**
–ü–æ–≤—Ç–æ—Ä–Ω—ã–π –º–∞—Ç—á–∏–Ω–≥ –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ MB_RECHECK_HOURS (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 168 —á–∞—Å–æ–≤ / 7 –¥–Ω–µ–π).
–ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å Run (force) ‚Äî –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç cool-down.

üîó **API (–æ—Å–Ω–æ–≤–Ω–æ–µ)**

## **–°–∏—Å—Ç–µ–º–Ω—ã–µ**

**GET** `/api/health`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∂–∏–≤–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–û—Ç–≤–µ—Ç (200):**
```
{ "status": "ok", "uptimeSec": 12345, "version": "x.y.z", "now": "2025-08-16T10:00:00Z" }
```

**GET** `/api/stats` ‚Äî ‚úÖ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
–ê–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –±–∏–±–ª–∏–æ—Ç–µ–∫–µ/–∑–∞–¥–∞—á–∞–º.

**–û—Ç–≤–µ—Ç (200):**
```
{
"artists": 412,
"albums": 1890,
"tracks": 21543,
"unmatched": 238,
"lastRunAt": "2025-08-16T08:40:12Z",
"durations": { "syncMsP50": 8200, "syncMsP95": 19400 }
}
```
## **–ó–∞–ø—É—Å–∫–∏ –∏ –ª–æ–≥–∏**

**GET** `/api/runs?limit=30` ‚Äî ‚úÖ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
–°–ø–∏—Å–æ–∫ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–ø—É—Å–∫–æ–≤ (sync/push/backup –∏ —Ç.–ø.).

**–û—Ç–≤–µ—Ç (200):**
```
[
{ "id": "run_01H...", "type": "yandex_sync", "startedAt": "2025-08-16T08:39:55Z", "status": "ok", "durationMs": 10422 },
{ "id": "run_01H...", "type": "lidarr_push", "startedAt": "2025-08-16T08:12:00Z", "status": "error", "durationMs": 3110 }
]
```

**GET** `/api/runs/:id`
–î–µ—Ç–∞–ª–∏ –∑–∞–ø—É—Å–∫–∞. 

**–û—Ç–≤–µ—Ç (200):**
```
{ "id": "run_01H...", "type": "yandex_sync", "status": "ok", "metrics": { "found": 320, "unmatched": 12 } }
```

**GET** `/api/runs/:id/logs` ‚Äî ‚úÖ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–æ
–°—Ç—Ä–∏–º/–ª–µ–Ω—Ç–∞ –ª–æ–≥–æ–≤ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞.

**–û—Ç–≤–µ—Ç (200):**
```
[
{ "ts": "2025-08-16T08:40:01Z", "level": "info", "msg": "Login OK" },
{ "ts": "2025-08-16T08:40:04Z", "level": "info", "msg": "Fetched 250 tracks" }
]
```

## **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∏ –≤–æ—Ä–∫–µ—Ä—ã**

**GET** `/api/scheduler`
–¢–µ–∫—É—â–∏–µ cron-–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∑–∞–¥–∞—á.

**–û—Ç–≤–µ—Ç (200):**
```
{ "yandexSync": "0 */2 * * *", "lidarrPush": "15 */2 * * *", "backup": "0 3 * * *" }
```

**PUT** `/api/scheduler`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ cron-–º–∞—Å–æ–∫.

**Body:**
```
{ "yandexSync": "*/30 * * * *" }
```

**GET** `/api/workers`
–°—Ç–∞—Ç—É—Å—ã —Ñ–æ–Ω–æ–≤—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤.

**–û—Ç–≤–µ—Ç (200):**
```
[
{ "name": "yandex", "running": true, "lastRun": "2025-08-16T08:40:12Z" },
{ "name": "lidarr", "running": true, "lastRun": "2025-08-16T08:12:45Z" },
{ "name": "backup", "running": false, "lastRun": "2025-08-15T03:00:11Z" }
]
```

**POST** `/api/workers/:name/start` `/ POST /api/workers/:name/stop`
**–ó–∞–ø—É—Å–∫/–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–æ—Ä–∫–µ—Ä–∞.**

## **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è**

**POST** `/api/sync/yandex`
–ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–±–æ—Ä –±–∏–±–ª–∏–æ—Ç–µ–∫–∏/–ø–ª–µ–π–ª–∏—Å—Ç–æ–≤ –∏–∑ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏.

*body (–æ–ø—Ü.):*
```
{ "playlists": ["liked", "custom:12345"], "fullRescan": false }
```

*–û—Ç–≤–µ—Ç (202):*
```
{ "runId": "run_01H..." }
```

**POST** `/api/sync/lidarr`
–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—É—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≤ Lidarr.

**–û—Ç–≤–µ—Ç (202):**
```
{ "runId": "run_01H..." }
```

**GET** `/api/sync/status`
–ö–æ—Ä–æ—Ç–∫–∏–π —Å—Ç–∞—Ç—É—Å –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞ sync‚Üímatch‚Üípush.

**–û—Ç–≤–µ—Ç (200):**
```
{ "phase": "match", "progress": 0.42, "runId": "run_01H..." }
```

## **–î–∞–Ω–Ω—ã–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏**

**GET** `/api/found`
–°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã–µ —Ä–µ–ª–∏–∑—ã/—Ç—Ä–µ–∫–∏ (–µ—Å—Ç—å MBID/Lidarr ID).
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `q`, `limit`, `offset`, `artistId`

**–û—Ç–≤–µ—Ç (200):**
```
{ "total": 320, "items": [ { "trackId": "y:123", "title": "Song", "mbid": "xxx", "lidarrId": 777 } ] }
```

**GET** `/api/unmatched`
–ù–∞–π–¥–µ–Ω–æ –≤ –Ø.–ú—É–∑—ã–∫–µ, –Ω–æ –±–µ–∑ —Ç–æ—á–Ω–æ–≥–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è.

**–û—Ç–≤–µ—Ç (200):**
```
{ "total": 238, "items": [ { "trackId": "y:999", "title": "Unknown mix", "hints": ["artist: ...", "album: ..."] } ] }
```

**POST** `/api/unmatched/:trackId/match`
–†—É—á–Ω–æ–µ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ.

**body:**
```
{ "mbid": "a1b2c3-..." }
```

**GET** `/api/export`
–í—ã–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è (CSV/JSON).
–ü–∞—Ä–∞–º–µ—Ç—Ä—ã: `format=csv|json`

**–û—Ç–≤–µ—Ç (CSV)**: —Ñ–∞–π–ª; **(JSON)**:
```
{ "exportedAt": "2025-08-16T08:45:00Z", "items": [ ... ] }
```

## **–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**

**GET** `/api/settings`
–¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤).

**–û—Ç–≤–µ—Ç (200):**
```
{
"yandex": { "login": "user@example.com", "authorized": true },
"lidarr": { "url": "http://lidarr:8686", "connected": true }
}
```

**PUT** `/api/settings`
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**Body (–ø—Ä–∏–º.):**
```
{
"yandex": { "token": "ya_cookie_or_token" },
"lidarr": { "url": "http://localhost:8686", "apiKey": "XXXX" }
}
```

**POST** `/api/settings/test/yandex`
–ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∞.

**–û—Ç–≤–µ—Ç (200):**
```
{ "ok": true, "profile": { "id": 12345, "name": "User" } }
```

**POST** `/api/settings/test/lidarr`
–ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å Lidarr.

*–û—Ç–≤–µ—Ç (200):*
```
{ "ok": true, "version": "2.3.1", "rootFolders": ["/music"] }
```

*POST* `/api/notify/test`
–¢–µ—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã).

*–û—Ç–≤–µ—Ç (200):*
```
{ "sent": true }
```

## **–ë—ç–∫–∞–ø—ã**

**POST** `/api/backup`
–°–æ–∑–¥–∞—Ç—å —Ä–µ–∑–µ—Ä–≤–Ω—É—é –∫–æ–ø–∏—é –ë–î/—Å–æ—Å—Ç–æ—è–Ω–∏—è.

**–û—Ç–≤–µ—Ç (202):**
```
{ "runId": "run_01H..." }
```

*GET* `/api/backup`
–°–ø–∏—Å–æ–∫ –±—ç–∫–∞–ø–æ–≤.

**–û—Ç–≤–µ—Ç (200):**
```
[
{ "id": "bkp_20250816_030000", "size": 1048576, "createdAt": "2025-08-16T03:00:00Z" }
]
```

**GET** `/api/backup/:id/download`
**–°–∫–∞—á–∞—Ç—å –∞—Ä—Ö–∏–≤ –±—ç–∫–∞–ø–∞** (`application/zip`).

## **–ü–æ–∏—Å–∫–æ–≤—ã–µ –ø—Ä–æ–∫—Å–∏ (MusicBrainz / Lidarr)**

**GET** `/api/mb/search`
–ü—Ä–æ–∫—Å–∏ –ø–æ MusicBrainz –¥–ª—è —Ä—É—á–Ω–æ–≥–æ –º–∞—Ç—á–∏–Ω–≥–∞.
**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:** `entity=artist|release|recording`, `q`

**–û—Ç–≤–µ—Ç (200):**
```
{ "count": 3, "items": [ { "id": "mbid", "title": "..." } ] }
```

*GET* `/api/mb/release/:mbid`
–î–µ—Ç–∞–ª–∏ —Ä–µ–ª–∏–∑–∞ MB.

**GET** `/api/lidarr/artists`
–°–ø–∏—Å–æ–∫ –∞—Ä—Ç–∏—Å—Ç–æ–≤ –≤ Lidarr (–¥–ª—è –≤—ã–±–æ—Ä–∞ —Ü–µ–ª–µ–π).

**–û—Ç–≤–µ—Ç (200):**
```
[ { "id": 777, "name": "Artist", "mbId": "..." } ]
```
## **–õ–æ–≥–∏ (–æ–±—â–∏–µ)**

**GET** `/api/logs/latest?tail=200`

–ü–æ—Å–ª–µ–¥–Ω–∏–µ N —Å—Ç—Ä–æ–∫ –æ–±—â–µ—Å–∏—Å—Ç–µ–º–Ω–æ–≥–æ –ª–æ–≥–∞.

**–û—Ç–≤–µ—Ç (200):**
```
{ "lines": ["[08:40:01] info ...", "..."] }
```
**–ö–æ–¥ –æ—Ç–≤–µ—Ç–∞/–æ—à–∏–±–∫–∏ (–æ–±—â–∏–µ –ø—Ä–∞–≤–∏–ª–∞)**
- 200/201 ‚Äî —É—Å–ø–µ—à–Ω—ã–π –æ—Ç–≤–µ—Ç —Å –¥–∞–Ω–Ω—ã–º–∏.
- 202 ‚Äî –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∑–∞–¥–∞—á–∞ —Å–æ–∑–¥–∞–Ω–∞; —Å–º. runId –∏ —á–∏—Ç–∞–π—Ç–µ /api/runs/:id/logs.
- 400 ‚Äî –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞.
- 401/403 ‚Äî –Ω–µ—Ç –¥–æ—Å—Ç—É–ø–∞ (–µ—Å–ª–∏ –≤–∫–ª—é—á–µ–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è).
- 404 ‚Äî —Ä–µ—Å—É—Ä—Å –Ω–µ –Ω–∞–π–¥–µ–Ω.
- 409 ‚Äî –∫–æ–Ω—Ñ–ª–∏–∫—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, —É–∂–µ –∏–¥—ë—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è).
- 500 ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è –æ—à–∏–±–∫–∞.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ –ø–æ ¬´–∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º¬ª –ø—É—Ç—è–º

–≠—Ç–∏ –ø—É—Ç–∏ –º–µ–Ω—è—Ç—å –Ω–µ–ª—å–∑—è (UI –Ω–∞ –Ω–∏—Ö –∑–∞–≤—è–∑–∞–Ω):
- **GET** `/api/runs?limit=30`
- **GET** `/api/runs/:id/logs`
- **GET** `/api/stats`

üîê **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è              | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                                                     | –ü—Ä–∏–º–µ—Ä                                   |
|--------------------------|----------------------------------------------------------------|------------------------------------------|
| **PORT_API**             | –ü–æ—Ä—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ API                                          | `PORT_API=4000`                          |
| **YA_PYPROXY_URL**       | URL PyProxy-—Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –Ø.–ú—É–∑—ã–∫–µ     | `YA_PYPROXY_URL=http://pyproxy:8081`     |
| **YANDEX_MUSIC_TOKEN**   | –û—Å–Ω–æ–≤–Ω–æ–π —Ç–æ–∫–µ–Ω –¥–æ—Å—Ç—É–ø–∞ –¥–ª—è –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏                      | `YANDEX_MUSIC_TOKEN=Y0_AgAAA...`         |
| **YM_TOKEN**             | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ –∏–º—è —Ç–æ–∫–µ–Ω–∞ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏                       | `YM_TOKEN=Y0_AgAAA...`                   |
| **MB_RECHECK_HOURS**     | –ö–æ–ª-–≤–æ —á–∞—Å–æ–≤ –¥–ª—è –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–π MusicBrainz       | `MB_RECHECK_HOURS=168`                   |
| **YA_UA**                | –ö–∞—Å—Ç–æ–º–Ω—ã–π User-Agent –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–µ             | `YA_UA=MyApp/1.0 (Linux; x86_64)`        |
| **YA_CLIENT**            | –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –∫–ª–∏–µ–Ω—Ç–∞ –Ø–Ω–¥–µ–∫—Å.–ú—É–∑—ã–∫–∏                           | `YA_CLIENT=Android/240213`               |
| **NEXT_PUBLIC_API_BASE** | –ë–∞–∑–æ–≤—ã–π URL API –¥–ª—è —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞ (Next.js, –¥–æ—Å—Ç—É–ø–Ω–æ –≤ –±—Ä–∞—É–∑–µ—Ä–µ)  | `NEXT_PUBLIC_API_BASE=https://host/api`  |


`–ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –º–æ–∂–Ω–æ –∑–∞–¥–∞—Ç—å —É–∂–µ –≤–æ —Ñ—Ä–æ–Ω—Ç–µ (Settings) ‚Äî –æ–Ω–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ SQLite.`

üß™ **–ù–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏**

**Telegram**: —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–∏–Ω–∫–∞ (ok/error) —Å –∫—Ä–∞—Ç–∫–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π.

**Webhook**: POST JSON –≤–∏–¥–∞:

```json
{
  "source": "yandex",
  "status": "ok",
  "runId": 123,
  "stats": { "...": "..." }
}
```

–ï—Å–ª–∏ –∑–∞–¥–∞–Ω `webhookSecret`, –¥–æ–±–∞–≤–ª—è–µ–º –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Signature: sha256=<HMAC>`.

üß∞ **–¢—Ä–∞–±–ª—à—É—Ç–∏–Ω–≥**

- **403 SmartCaptcha –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞**

      –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –¥—Ä–∞–π–≤–µ—Ä pyproxy (—Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ) –∏ –±–µ–ª—ã–π IP (–Ω–µ DC/VPN).

  –í native –≤–æ–∑–º–æ–∂–Ω—ã –±–ª–æ–∫–∏ —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã –Ø–ú.

- **Next.js —Ä—É–≥–∞–µ—Ç—Å—è –Ω–∞ Node**

  –ù—É–∂–µ–Ω Node ‚â• 18.17 (–ª—É—á—à–µ 20.x).

- **Prisma/SQLite/openssl –≤ alpine-–æ–±—Ä–∞–∑–∞—Ö**

  –ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º Debian-based –æ–±—Ä–∞–∑—ã. –ï—Å–ª–∏ —Å–æ–±–∏—Ä–∞–µ—Ç–µ —Å–≤–æ—ë ‚Äî —Å—Ç–∞–≤—å—Ç–µ —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π OpenSSL.

- **–ü—É—Å—Ç—ã–µ —Å–ø–∏—Å–∫–∏ Found/Unmatched**

  –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–∏–Ω–∫ –ø—Ä–æ—à—ë–ª (Overview ‚Üí Run) –∏ —á—Ç–æ —Ñ—Ä–æ–Ω—Ç —Å—Ç—É—á–∏—Ç—Å—è –≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ —Ä–æ—É—Ç—ã /api/found –∏ /api/unmatched.

ü§ù **Contributing**

**PR –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é—Ç—Å—è**: –±–∞–≥—Ñ–∏–∫—Å—ã, —É–ª—É—á—à–µ–Ω–∏—è UI, –Ω–æ–≤—ã–µ –¥—Ä–∞–π–≤–µ—Ä—ã, –¥–æ–ø. —Ñ–æ—Ä–º–∞—Ç—ã —ç–∫—Å–ø–æ—Ä—Ç–∞.
**–ü–µ—Ä–µ–¥ PR**: `npm i`, `npx prisma generate`, –ª–∏–Ω—Ç, —Å–±–æ—Ä–∫–∞ web/api, –±—ã—Å—Ç—Ä—ã–π –ø—Ä–æ–≥–æ–Ω –≤ docker compose.

üó∫Ô∏è **Roadmap**

- –í—ã–±–æ—Ä–æ—á–Ω–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –≤—Ä—É—á–Ω—É—é (assign MBID/RG).
- –ü–∞–∫–µ—Ç–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è/–æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –¥—É–±–ª–µ–π.
- –°–∏–Ω—Ö —Ö—É–¥–æ–∂–Ω–∏–∫–æ–≤/–∞–ª—å–±–æ–º–æ–≤ –∏–∑ Lidarr –æ–±—Ä–∞—Ç–Ω–æ –≤ –Ø–ú (–∏–¥–µ—è).
- SSE/WebSocket –¥–ª—è live-–ª–æ–≥–æ–≤ (–≤–º–µ—Å—Ç–æ polling).
- –†–æ–ª–∏/–¥–æ—Å—Ç—É–ø—ã (–µ—Å–ª–∏ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è).
- –ø–æ–∏—Å–∫/—Ñ–∏–ª—å—Ç—Ä –ø–æ –ª–æ–≥–∞–º (artist/album/level),
- —ç–∫—Å–ø–æ—Ä—Ç —Ç–µ–∫—É—â–µ–≥–æ –ª–æ–≥–∞ (NDJSON/CSV),
- –∞–≤—Ç–æ—Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ debug –∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å ‚Äúcompact/verbose‚Äù,
- —Ä–µ—Ç–µ–Ω—à–Ω –¥–ª—è —Å—Ç–∞—Ä—ã—Ö runs (–æ—á–∏—Å—Ç–∫–∞ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É/–≤–æ–∑—Ä–∞—Å—Ç—É),
- –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: –¥–æ–±–∞–≤–ª—é –≤ ‚ÄúArtist skip‚Äù –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç—Ä–µ–∫–∞ ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ —Ä–∞—Å—à–∏—Ä—é —Å–±–æ—Ä –ª–∞–π–∫–æ–≤ –Ø.–ú—É–∑—ã–∫–∏ –¥–æ —Ç—Ä–µ–∫–æ–≤ –∏ –±—É–¥—É –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å data.song.
- –û–Ω–ª–∞–π–Ω –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–∑ –±–∞–∑–µ –Ω–∞ –≥–ª–∞–≤–Ω–æ–π –∏ –≤ –ª–æ–≥–∞—Ö